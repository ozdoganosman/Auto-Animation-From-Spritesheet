(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))e(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&e(c)}).observe(document,{childList:!0,subtree:!0});function l(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function e(n){if(n.ep)return;n.ep=!0;const o=l(n);fetch(n.href,o)}})();function G(r){return new Promise((t,l)=>{const e=new Image;e.src=r,e.onload=()=>t(e),e.onerror=n=>l(n)})}function Q(r,t){const l=r.naturalWidth||r.width,e=r.naturalHeight||r.height;if(!l||!e)return null;const n=_(r,{alphaThreshold:t==null?void 0:t.alphaThreshold,bgTolerance:t==null?void 0:t.bgTolerance,bgColor:t==null?void 0:t.bgColor}),o=K(n.data,l,e),c=new Array(l).fill(!1),s=new Array(e).fill(!1);for(let a=0;a<e;a++)I(o,l,e,0,a,l,1)>0&&(s[a]=!0);for(let a=0;a<l;a++)I(o,l,e,a,0,1,e)>0&&(c[a]=!0);const i=R(E(c),1),d=R(E(s),1);if(i.length===0||d.length===0)return null;const g=[];for(const a of d)for(const m of i)I(o,l,e,m.start,a.start,m.len,a.len)>0&&g.push({x:m.start,y:a.start,w:m.len,h:a.len});const u=L(i.map(a=>a.len)),h=L(d.map(a=>a.len));return{cols:i.length,rows:d.length,frameWidth:u,frameHeight:h,rects:g}}function E(r){const t=[],l=r.length;let e=-1;for(let n=0;n<l;n++){const o=r[n];o&&e===-1&&(e=n),!o&&e!==-1&&(t.push({start:e,len:n-e}),e=-1)}return e!==-1&&t.push({start:e,len:l-e}),t}function L(r){const t={};let l=r[0]||0,e=0;for(const n of r){const o=String(n),c=t[o]=(t[o]||0)+1;c>e&&(e=c,l=n)}return l}function V(r,t){const e=r.naturalWidth||r.width,n=r.naturalHeight||r.height;if(!e||!n)return null;const o=_(r,{alphaThreshold:t==null?void 0:t.alphaThreshold,bgTolerance:t==null?void 0:t.bgTolerance,bgColor:t==null?void 0:t.bgColor}),c=K(o.data,e,n),s=new Array(n).fill(!1);for(let f=0;f<n;f++)I(c,e,n,0,f,e,1)>0&&(s[f]=!0);const i=E(s);if(!i.length)return null;const d=new Array(e).fill(!1);for(let f=0;f<e;f++)I(c,e,n,f,0,1,n)>0&&(d[f]=!0);const g=R(E(d),1),u=L(i.map(f=>f.len)),h=g.length?L(g.map(f=>f.len)):u,a=[];for(let f=0;f<i.length;f++){const y=i[f],D=new Array(e).fill(!1);for(let w=0;w<e;w++)I(c,e,n,w,y.start,1,y.len)>0&&(D[w]=!0);const J=R(E(D),1),F=[];for(const w of J){const $=I(c,e,n,w.start,y.start,w.len,y.len),k=w.len*y.len;if(k<=0)continue;$/k>=.01&&F.push({x:w.start,y:y.start,w:w.len,h:y.len})}F.length&&a.push({name:`anim_${f}`,rects:F})}const m=a.length?L(a.map(f=>f.rects.length)):0;return{frameWidth:h,frameHeight:u,cols:m,animations:a}}function K(r,t,l){const e=new Int32Array((t+1)*(l+1));for(let n=1;n<=l;n++){let o=0;for(let c=1;c<=t;c++){const s=r[(n-1)*t+(c-1)]?1:0;o+=s;const i=n*(t+1)+c;e[i]=e[(n-1)*(t+1)+c]+o}}return e}function I(r,t,l,e,n,o,c){const s=t+1,i=e,d=n,g=e+o,u=n+c,h=r[d*s+i],a=r[d*s+g],m=r[u*s+i];return r[u*s+g]-a-m+h}function _(r,t){const l=r.naturalWidth||r.width,e=r.naturalHeight||r.height,n=document.createElement("canvas");n.width=l,n.height=e;const o=n.getContext("2d");o.drawImage(r,0,0);const c=o.getImageData(0,0,l,e).data,s=(t==null?void 0:t.alphaThreshold)??1;let i;t!=null&&t.bgColor?i=t.bgColor:i=X(c,l,e);const d=(t==null?void 0:t.bgTolerance)??16,g=new Uint8Array(l*e);for(let u=0;u<l*e;u++){const h=c[u*4+0],a=c[u*4+1],m=c[u*4+2],f=c[u*4+3],y=Math.abs(h-i[0])+Math.abs(a-i[1])+Math.abs(m-i[2]);g[u]=f>=s&&y>d?1:0}return{data:g}}function X(r,t,l){const e=[],n=s=>{e.push([r[s],r[s+1],r[s+2]])};for(let s=0;s<t;s++)n((0*t+s)*4),n(((l-1)*t+s)*4);for(let s=0;s<l;s++)n((s*t+0)*4),n((s*t+(t-1))*4);const o=new Map;for(const[s,i,d]of e){const g=s>>4&15,u=i>>4&15,h=d>>4&15,a=`${g},${u},${h}`,m=o.get(a);m?m[3]+=1:o.set(a,[g,u,h,1])}let c=[0,0,0,-1];for(const s of o.values())s[3]>c[3]&&(c=s);return[c[0]*16+8,c[1]*16+8,c[2]*16+8]}function R(r,t){if(r.length<=1)return r;const l=[];let e={...r[0]};for(let n=1;n<r.length;n++){const o=e.start+e.len;if(r[n].start-o<=t){const s=r[n].start+r[n].len;e.len=s-e.start}else l.push(e),e={...r[n]}}return l.push(e),l}const S=document.getElementById("cv"),v=S.getContext("2d"),U=document.getElementById("imgPath"),C=document.getElementById("imgFile"),p=document.getElementById("animSelect"),Y=document.getElementById("reload");let b=null,H=[],A=[],q=performance.now(),x=0,P=0;const N=80;let M=64,B=64,T=1,O=1;async function W(){const r=C&&C.files&&C.files[0]||null;if(r){const t=URL.createObjectURL(r);try{b=await G(t)}catch{b=null}finally{URL.revokeObjectURL(t)}}else{const t=U&&U.value||"assets/spritesheet.png";try{b=await G(t)}catch{b=null}}if(H=[],b){const t=V(b);if(t&&t.animations.length)A=t.animations,H=A[0].rects,M=t.frameWidth,B=t.frameHeight,T=t.cols,O=t.animations.length,p&&(p.innerHTML="",A.forEach((l,e)=>{const n=document.createElement("option");n.value=String(e),n.textContent=l.name,p.appendChild(n)}),p.value="0");else{const l=Q(b);l&&l.rects.length&&(H=l.rects,M=l.frameWidth,B=l.frameHeight,T=l.cols,O=l.rows)}}x=0,P=0}Y.addEventListener("click",()=>{W().catch(console.error)});C&&C.addEventListener("change",()=>{W().catch(console.error)});p&&p.addEventListener("change",()=>{var t;const r=parseInt(p.value,10)||0;H=((t=A[r])==null?void 0:t.rects)||H,x=0});function j(r,t,l,e,n){const o=r*37%360;v.fillStyle=`hsl(${o} 60% 50%)`,v.fillRect(e,n,t,l),v.fillStyle="#000",v.font="16px system-ui",v.fillText(`#${r}`,e+8,n+22)}function z(r){const t=r-q;q=r,v.clearRect(0,0,S.width,S.height);const l=M||64,e=B||64,n=H.length||T*O,o=2,c=l*o,s=e*o,i=(S.width-c)/2,d=(S.height-s)/2;for(P+=t;P>=N;)P-=N,x=(x+1)%Math.max(1,n);const g=x%T,u=Math.floor(x/T);if(b){const h=H[x],a=h?h.x:g*l,m=h?h.y:u*e,f=h?h.w:l,y=h?h.h:e;try{v.drawImage(b,a,m,f,y,i,d,c,s)}catch{j(x,c,s,i,d)}}else j(x,c,s,i,d);requestAnimationFrame(z)}W().then(()=>requestAnimationFrame(z)).catch(console.error);
